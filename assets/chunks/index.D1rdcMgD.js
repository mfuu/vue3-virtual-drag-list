import{c as Rt,g as Ht}from"./commonjsHelpers.Cpj98o6Y.js";import{d as Mt,aj as yt,p as gt,h as _t,q as Et,ak as Lt,al as Kt,am as Pt,v as Ut,x as Yt,an as Wt}from"./framework.Tst34yPz.js";var At={exports:{}};/*!
 * sortable-dnd v0.6.19
 * open source under the MIT license
 * https://github.com/mfuu/sortable-dnd#readme
 */(function(u,o){(function(i,l){u.exports=l()})(Rt,function(){function i(t){return i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},i(t)}function l(){return l=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t},l.apply(this,arguments)}var d={capture:!1,passive:!1},y=/\s+/g;function T(t){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(t)}var Q=T(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),L=T(/Edge/i),O=T(/safari/i)&&!T(/chrome/i)&&!T(/android/i),it=function(){var t=!1;return document.addEventListener("checkIfSupportPassive",null,{get passive(){return t=!0,!0}}),t}();function A(t,n,e){window.addEventListener?t.addEventListener(n,e,!(!it&&Q)&&d):window.attachEvent?t.attachEvent("on"+n,e):t["on"+n]=e}function M(t,n,e){window.removeEventListener?t.removeEventListener(n,e,!(!it&&Q)&&d):window.detachEvent?t.detachEvent("on"+n,e):t["on"+n]=null}function st(){return document.scrollingElement||document.documentElement}function K(t,n,e){if(t.getBoundingClientRect||t===window){var s,r,c,h,g,z,H;if(t!==window&&t.parentNode&&t!==st()?(r=(s=t.getBoundingClientRect()).top,c=s.left,h=s.bottom,g=s.right,z=s.height,H=s.width):(r=0,c=0,h=window.innerHeight,g=window.innerWidth,z=window.innerHeight,H=window.innerWidth),n&&t!==window){e=e||t.parentNode;do if(e&&e.getBoundingClientRect){var I=e.getBoundingClientRect();r-=I.top+parseInt(w(e,"border-top-width")),c-=I.left+parseInt(w(e,"border-left-width")),h=r+s.height,g=c+s.width;break}while(e=e.parentNode)}return{top:r,left:c,bottom:h,right:g,width:H,height:z}}}function ut(t,n,e,s){if(t){if(e&&!n){for(var r=Array.prototype.slice.call(e.children),c=0,h=r.length;c<h;c++)if(r[c]===t||mt(t,r[c]))return r[c]}e=e||document;do{if(n!=null&&(n[0]===">"?t.parentNode===e&&dt(t,n):dt(t,n))||s&&t===e)return t;if(t===e)break}while(t=t.parentNode);return null}}function mt(t,n){if(!t||!n)return!1;if(n.compareDocumentPosition)return!!(16&n.compareDocumentPosition(t));if(n.contains&&t.nodeType===1)return n.contains(t)&&n!==t;for(;t=t.parentNode;)if(t===n)return!0;return!1}function wt(t,n){for(var e=t.lastElementChild;e&&(e===C.ghost||w(e,"display")==="none"||n);)e=e.previousElementSibling;return e||null}function Z(t,n){if(!t||!t.parentNode)return-1;for(var e=0;t=t.previousElementSibling;)t.nodeName.toUpperCase()==="TEMPLATE"||n&&!dt(t,n)||w(t,"display")==="none"||e++;return e}function nt(t,n,e,s){for(var r=0,c=0,h=t.children;r<h.length;){if(h[r]!==C.ghost&&w(h[r],"display")!=="none"&&ut(h[r],e,t,!1)&&h[r]!==C.dragged){if(c===n)return h[r];c++}r++}return null}function rt(t,n){var e=w(t),s=parseInt(e.width)-parseInt(e.paddingLeft)-parseInt(e.paddingRight)-parseInt(e.borderLeftWidth)-parseInt(e.borderRightWidth),r=nt(t,0,n),c=nt(t,1,n),h=r&&w(r),g=c&&w(c),z=h&&parseInt(h.marginLeft)+parseInt(h.marginRight)+K(r).width,H=g&&parseInt(g.marginLeft)+parseInt(g.marginRight)+K(c).width,I=L||Q?"cssFloat":"float";if(e.display==="flex")return e.flexDirection==="column"||e.flexDirection==="column-reverse"?"vertical":"horizontal";if(e.display==="grid")return e.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(r&&h.float&&h.float!=="none"){var E=h.float==="left"?"left":"right";return!c||g.clear!=="both"&&g.clear!==E?"horizontal":"vertical"}return r&&(h.display==="block"||h.display==="flex"||h.display==="table"||h.display==="grid"||z>=s&&e[I]==="none"||c&&e[I]==="none"&&z+H>s)?"vertical":"horizontal"}function P(t,n,e){if(t&&n)if(t.classList)t.classList[e?"add":"remove"](n);else{var s=(" "+t.className+" ").replace(y," ").replace(" "+n+" "," ");t.className=(s+(e?" "+n:"")).replace(y," ")}}function dt(t,n){if(n){if(n[0]===">"&&(n=n.substring(1)),t)try{if(t.matches)return t.matches(n);if(t.msMatchesSelector)return t.msMatchesSelector(n);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(n)}catch{return!1}return!1}}function w(t,n,e){var s=t&&t.style;if(s){if(e===void 0)return document.defaultView&&document.defaultView.getComputedStyle?e=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(e=t.currentStyle),n===void 0?e:e[n];n in s||n.indexOf("webkit")!==-1||(n="-webkit-"+n),s[n]=e+(typeof e=="string"?"":"px")}}function lt(t,n){var e,s,r=(s=n,(e=t).compareDocumentPosition?e.compareDocumentPosition(s):e.contains?(e!=s&&e.contains(s)&&16)+(e!=s&&s.contains(e)&&8)+(e.sourceIndex>=0&&s.sourceIndex>=0?(e.sourceIndex<s.sourceIndex&&4)+(e.sourceIndex>s.sourceIndex&&2):1):0);return r===2?1:r===4?-1:0}function S(t){t.preventDefault!==void 0&&t.cancelable&&t.preventDefault()}function k(t){var n=t.sortable,e=t.name,s=t.params,r=n.options[e];typeof r=="function"&&r(l({},s))}(function(){if(typeof window>"u"||typeof document>"u")return"";var t=window.getComputedStyle(document.documentElement,"")||["-moz-hidden-iframe"];(Array.prototype.slice.call(t).join("").match(/-(moz|webkit|ms)-/)||t.OLink===""&&["","o"])[1]})();var D,at,vt,Y="Sortable"+Date.now();function xt(t){this.options=t,this.autoScrollAnimationFrame=null}function zt(t){this.options=t,this.stack=[]}function It(t){this.options=t||{},this.selects=[]}window.requestAnimationFrame||(window.requestAnimationFrame=function(t){return setTimeout(t,17)}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)}),xt.prototype={stop:function(){this.autoScrollAnimationFrame&&(cancelAnimationFrame(this.autoScrollAnimationFrame),this.autoScrollAnimationFrame=null)},start:function(t,n,e){var s=this;cancelAnimationFrame(this.autoScrollAnimationFrame),this.autoScrollAnimationFrame=requestAnimationFrame(function(){n&&e&&s.autoScroll(t,e),s.start(t,n,e)})},autoScroll:function(t,n){if(t&&n.clientX!==void 0&&n.clientY!==void 0){var e=K(t);if(e){var s=n.clientX,r=n.clientY,c=e.top,h=e.right,g=e.bottom,z=e.left,H=e.height,I=e.width;if(!(r<c||s>h||r>g||s<z)){var E=this.options,ot=E.scrollThreshold,tt=E.scrollSpeed,pt=t.scrollTop,_=t.scrollLeft,U=t.scrollHeight,Dt=pt>0&&r>=c&&r<=c+ot,Ct=_+I<t.scrollWidth&&s<=h&&s>=h-ot,Ft=pt+H<U&&r<=g&&r>=g-ot;_>0&&s>=z&&s<=z+ot&&(t.scrollLeft+=Math.floor(Math.max(-1,(s-z)/ot-1)*tt.x)),Ct&&(t.scrollLeft+=Math.ceil(Math.min(1,(s-h)/ot+1)*tt.x)),Dt&&(t.scrollTop+=Math.floor(Math.max(-1,(r-c)/ot-1)*tt.y)),Ft&&(t.scrollTop+=Math.ceil(Math.min(1,(r-g)/ot+1)*tt.y))}}}}},zt.prototype={collect:function(t){if(t){for(var n=K(t),e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,s=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,r=Math.min(n.right,e),c=Math.min(n.bottom,s),h=Array.prototype.slice.call(t.children),g=[],z=0,H=h.length;z<=H;z++){var I=h[z];if(I&&I!==C.ghost&&w(I,"display")!=="none"){var E=K(I);if(!(E.bottom<0||E.right<0)){if(E.top-E.height>c||E.left-E.width>r)break;g.push({el:I,rect:E})}}}this.stack.push(g)}},animate:function(){var t=this.stack.pop();if(t&&this.options.animation)for(var n=0,e=t.length;n<e;n++){var s=t[n],r=s.el,c=s.rect;this._excute(r,c)}},_excute:function(t,n){var e=K(t);if(e.top!==n.top||e.left!==n.left){var s=n.left-e.left,r=n.top-e.top;w(t,"transition",""),w(t,"transform","translate3d(".concat(s,"px, ").concat(r,"px, 0)")),t.offsetWidth;var c=this.options,h=c.animation,g=c.easing;w(t,"transition","transform ".concat(h,"ms ").concat(g?" "+g:"")),w(t,"transform","translate3d(0px, 0px, 0px)"),typeof t.animated=="number"&&clearTimeout(t.animated),t.animated=setTimeout(function(){w(t,"transition",""),w(t,"transform",""),t.animated=null},h)}}},It.prototype={active:function(){return!!D},nulling:function(){D=at=vt=null},params:function(){return{nodes:D||[],clones:at||[]}},select:function(t){P(t,this.options.selectedClass,!0),this.selects.push(t),this.selects.sort(function(n,e){return lt(n,e)})},deselect:function(t){var n=this.selects.indexOf(t);n>-1&&(P(t,this.options.selectedClass,!1),this.selects.splice(n,1))},useSelectHandle:function(t,n){var e=this.options.selectHandle;return!!(vt=typeof e=="function"&&e(t)||typeof e=="string"&&dt(n,e))},getGhostElement:function(){if(!D)return null;var t=document.createElement("div");return P(t,this.options.chosenClass,!0),this.selects.forEach(function(n,e){var s=n.cloneNode(!0),r=e===0?1:.5;s.style="position: absolute;left: 0;top: 0;bottom: 0;right: 0;opacity: ".concat(r,";z-index: ").concat(e,";"),t.appendChild(s)}),t},onChoose:function(){!this.options.multiple||this.selects.length===0||this.selects.indexOf(C.dragged)<0||(this.selects.sort(function(t,n){return lt(t,n)}),D=this.selects,this.toggleChosenClass(!0))},onDrop:function(t,n,e){if(D){var s=C.dragged,r=C.clone,c=D.indexOf(s);t!==n&&e?(w(r,"display","none"),this.toggleVisible(!0),at=D.map(function(h){return h.cloneNode(!0)}),this._sortElements(at,c,r)):this._sortElements(D,c,r),t!==n&&(n[Y].multiplayer.toggleSelected(at||D,!0),!e&&t[Y].multiplayer.toggleSelected(D,!1))}},onSelect:function(t,n,e,s){var r=this.options,c=r.multiple,h=r.selectHandle;if(c&&(h&&vt||!h&&!e)){var g=this.selects.indexOf(n);P(n,this.options.selectedClass,g<0);var z={from:s.el,event:t,node:n,index:Z(n)};g<0?(this.selects.push(n),k({sortable:s,name:"onSelect",params:z})):(this.selects.splice(g,1),k({sortable:s,name:"onDeselect",params:z})),this.selects.sort(function(H,I){return lt(H,I)})}},toggleChosenClass:function(t){if(D)for(var n=0,e=D.length;n<e;n++)P(D[n],this.options.chosenClass,t)},toggleVisible:function(t){if(D)for(var n=0,e=D.length;n<e;n++)D[n]!=C.dragged&&w(D[n],"display",t?"":"none")},toggleSelected:function(t,n){var e=this;n?t.forEach(function(s){return e.selects.push(s)}):this.selects=this.selects.filter(function(s){return t.indexOf(s)<0})},_sortElements:function(t,n,e){for(var s=0,r=t.length;s<r;s++)if(w(t[s],"display",""),s<n)e.parentNode.insertBefore(t[s],e);else{var c=s>0?t[s-1]:e;e.parentNode.insertBefore(t[s],c.nextSibling)}}};var G,v,B,p,b,ct,m,F,$,N,a,f,x,J,R,q,j,W,V,X,ht,St,ft=[];function bt(t){var n={},e=t.group;e&&i(e)=="object"||(e={name:e,pull:!0,put:!0,revertDrag:!0}),n.name=e.name,n.pull=e.pull,n.put=e.put,n.revertDrag=e.revertDrag,t.group=n}function Bt(t){var n=q||R;return!(t.clientX!==void 0&&t.clientY!==void 0&&Math.abs(t.clientX-n.clientX)<=0&&Math.abs(t.clientY-n.clientY)<=0)}function C(t,n){if(!t||!t.nodeType||t.nodeType!==1)throw"Sortable-dnd: `el` must be an HTMLElement, not ".concat({}.toString.call(t));t[Y]=this,this.el=t,this.options=n=l({},n);var e={store:null,group:"",handle:null,sortable:!0,disabled:!1,multiple:!1,lockAxis:"",direction:"",animation:150,easing:"",draggable:null,selectHandle:null,customGhost:null,autoScroll:!0,scrollThreshold:55,scrollSpeed:{x:10,y:10},delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,ghostClass:"",ghostStyle:{},chosenClass:"",selectedClass:"",placeholderClass:"",swapOnDrop:!0,fallbackOnBody:!1,supportTouch:"ontouchstart"in window,emptyInsertThreshold:-1};for(var s in e)!(s in this.options)&&(this.options[s]=e[s]);for(var r in bt(n),this)r.charAt(0)==="_"&&typeof this[r]=="function"&&(this[r]=this[r].bind(this));A(t,this.options.supportTouch?"touchstart":"mousedown",this._onDrag),this.autoScroller=new xt(this.options),this.multiplayer=new It(this.options),this.animator=new zt(this.options),ft.push(t)}return C.prototype={constructor:C,_onDrag:function(t){var n=this;if(!p&&!this.options.disabled&&this.options.group.pull&&(!/mousedown|pointerdown/.test(t.type)||t.button===0)){var e=t.touches&&t.touches[0],s=(e||t).target;if(!O||!s||s.tagName.toUpperCase()!=="SELECT"){var r=ut(s,this.options.draggable,this.el);if(r&&!r.animated&&(R={event:t,clientX:(e||t).clientX,clientY:(e||t).clientY},p=r,A(X=e?p:document,"mouseup",this._onDrop),A(X,"touchend",this._onDrop),A(X,"touchcancel",this._onDrop),!this.multiplayer.useSelectHandle(t,s))){var c=this.options.handle;if((typeof c!="function"||c(t))&&(typeof c!="string"||dt(s,c))){var h=this.options,g=h.delay,z=h.delayOnTouchOnly;!g||z&&!e||L||Q?this._onStart(e,t):(A(this.el.ownerDocument,"touchmove",this._delayMoveHandler),A(this.el.ownerDocument,"mousemove",this._delayMoveHandler),A(this.el.ownerDocument,"mouseup",this._cancelStart),A(this.el.ownerDocument,"touchend",this._cancelStart),A(this.el.ownerDocument,"touchcancel",this._cancelStart),St=setTimeout(function(){return n._onStart(e,t)},g)),A(document,"selectstart",S),O&&w(document.body,"user-select","none")}}}}},_delayMoveHandler:function(t){var n=t.touches?t.touches[0]:t;Math.max(Math.abs(n.clientX-R.clientX),Math.abs(n.clientY-R.clientY))>=Math.floor(this.options.touchStartThreshold/(window.devicePixelRatio||1))&&this._cancelStart()},_cancelStart:function(){clearTimeout(St),M(this.el.ownerDocument,"touchmove",this._delayMoveHandler),M(this.el.ownerDocument,"mousemove",this._delayMoveHandler),M(this.el.ownerDocument,"mouseup",this._cancelStart),M(this.el.ownerDocument,"touchend",this._cancelStart),M(this.el.ownerDocument,"touchcancel",this._cancelStart),M(document,"selectstart",S),O&&w(document.body,"user-select","")},_onStart:function(t,n){S(n);var e=Z(p);G=this.el,v=this.el,$=p,f=e,x=e,J=e,W={to:this.el,target:p,newIndex:e,relative:0},V=p,B=this.el,m=p.cloneNode(!0),N=p.parentNode,a=this.options.group.pull,C.clone=m,C.active=this,C.dragged=p,this.multiplayer.onChoose(),P(p,this.options.chosenClass,!0),k({sortable:this,name:"onChoose",params:this._getParams(n)}),A(X,t?"touchmove":"mousemove",this._nearestSortable);try{document.selection?setTimeout(function(){return document.selection.empty()},0):window.getSelection().removeAllRanges()}catch{}},_onStarted:function(){this.animator.collect(N),P(m,this.options.chosenClass,!0),P(m,this.options.placeholderClass,!0),this._appendGhost(),this.multiplayer.toggleVisible(!1),w(p,"display","none"),p.parentNode.insertBefore(m,p),k({sortable:this,name:"onDrag",params:this._getParams(R.event)}),this.animator.animate()},_getGhostElement:function(){var t=this.options.customGhost;if(typeof t=="function"){var n=this.multiplayer.selects;return t(n.length?n:[p])}return this.multiplayer.getGhostElement()||p},_appendGhost:function(){if(!F){var t=this.options.fallbackOnBody?document.body:this.el,n=this._getGhostElement();P(F=n.cloneNode(!0),this.options.ghostClass,!0);var e=K(p),s=l({position:"fixed",top:e.top,left:e.left,width:e.width,height:e.height,zIndex:"100000",opacity:"0.8",overflow:"hidden",boxSizing:"border-box",transform:"",transition:"",pointerEvents:"none"},this.options.ghostStyle);for(var r in s)w(F,r,s[r]);C.ghost=F,t.appendChild(F);var c=(R.clientX-e.left)/parseInt(F.style.width)*100,h=(R.clientY-e.top)/parseInt(F.style.height)*100;w(F,"transform-origin","".concat(c,"% ").concat(h,"%")),w(F,"will-change","transform")}},_nearestSortable:function(t){S(t);var n=t.touches&&t.touches[0]||t;if(p&&Bt(n)){!q&&this._onStarted();var e=this.options.lockAxis,s=e==="x"?R.clientX:n.clientX,r=e==="y"?R.clientY:n.clientY,c=document.elementFromPoint(s,r),h=s-R.clientX,g=r-R.clientY;q={event:t,clientX:s,clientY:r},w(F,"transform","translate3d(".concat(h,"px, ").concat(g,"px, 0)"));var z,H,I,E=(z=s,H=r,ft.reduce(function(tt,pt){var _=pt[Y].options.emptyInsertThreshold;if(_!=null){var U=K(pt),Dt=z>=U.left-_&&z<=U.right+_,Ct=H>=U.top-_&&H<=U.bottom+_;return Dt&&Ct&&(!I||I&&U.left>=I.left&&U.right<=I.right&&U.top>=I.top&&U.bottom<=I.bottom)&&(tt=pt,I=U),tt}},null));if(E&&E[Y]._onMove(t,c),!E||E[Y].options.autoScroll){var ot=function(tt,pt){if(!tt||!tt.getBoundingClientRect)return st();var _=tt;do if(_.clientWidth<_.scrollWidth||_.clientHeight<_.scrollHeight){var U=w(_);if(_.clientWidth<_.scrollWidth&&(U.overflowX=="auto"||U.overflowX=="scroll")||_.clientHeight<_.scrollHeight&&(U.overflowY=="auto"||U.overflowY=="scroll"))return!_.getBoundingClientRect||_===document.body?st():_}while(_=_.parentNode);return st()}(c);this.autoScroller.start(ot,R,q)}else this.autoScroller.stop()}},_allowPut:function(){if(B===this.el)return!0;if(!this.options.group.put)return!1;var t=this.options.group,n=t.name,e=t.put,s=B[Y].options.group;return e.join&&e.indexOf(s.name)>-1||s.name&&n&&s.name===n},_getDirection:function(){var t=this.options,n=t.draggable,e=t.direction;return e?typeof e=="function"?e.call(q.event,m,this):e:rt(N,n)},_allowSwap:function(){var t=K(b),n=this._getDirection()==="vertical",e=n?"top":"left",s=n?"bottom":"right",r=b[n?"offsetHeight":"offsetWidth"],c=n?q.clientY:q.clientX,h=c>=t[e]&&c<t[s]-r/2?-1:1,g=nt(N,0,this.options.draggable),z=wt(N),H=K(g),I=K(z);if(b===N||mt(N,b))return m===g&&c<H[e]?(ct=b,!0):m===z&&c>I[s]&&(ct=b.nextSibling,!0);var E=lt(m,b);return ct=E<0?b.nextSibling:b,j!==b?(ht=h,!0):ht!==h&&(ht=h,h<0?E>0:E<0)},_onMove:function(t,n){if(!this.options.disabled&&this._allowPut()){if(b=ut(n,this.options.draggable,this.el),k({sortable:this,name:"onMove",params:this._getParams(t,{target:b})}),this.options.sortable||this.el!==B)return this.el===v||n!==this.el&&wt(this.el)?void(b&&!b.animated&&!mt(b,m)&&this._allowSwap()&&(b!==m&&ct!==m&&(this.el!==v?this._onInsert(t):b!==p&&this._onChange(t)),j=b)):(b=j=null,void this._onInsert(t));v!==B&&(b=j=p,ht=0,this._onInsert(t))}},_onInsert:function(t){var n=b||m,e=a==="clone"&&this.el!==B&&v===B,s=a==="clone"&&this.el===B&&v!==B,r=mt(b,document),c=b===p&&!r,h=v[Y],g=B[Y];G=this.el,f=Z(m),$=n,N=r?b.parentNode:this.el,h.animator.collect(m.parentNode),this.animator.collect(N),e&&(W.target=V,W.newIndex=f,W.relative=V===p?0:lt(m,V),w(p,"display",""),g.multiplayer.toggleVisible(!0),g.options.group.revertDrag||m.parentNode.insertBefore(p,m)),s&&(f=Z(p),w(p,"display","none"),this.multiplayer.toggleVisible(!1)),w(m,"display",c?"none":""),b&&r?N.insertBefore(m,ht<0?b:b.nextSibling):N.appendChild(m),x=c?J:Z(m),e&&g.options.group.revertDrag&&(W.target=p,W.newIndex=J,W.relative=0,k({sortable:g,name:"onChange",params:this._getParams(t,{to:B,target:p,newIndex:J,revertDrag:!0})})),e||k({sortable:h,name:"onRemove",params:this._getParams(t,{newIndex:-1})}),s&&n!==p&&(V=n,k({sortable:this,name:"onChange",params:this._getParams(t,{from:B,backToOrigin:!0})})),s||k({sortable:this,name:"onAdd",params:this._getParams(t,{oldIndex:-1})}),h.animator.animate(),this.animator.animate(),v=this.el},_onChange:function(t){this.animator.collect(N),f=Z(m),N=b.parentNode,$=b,this.el===B&&(V=b),N.insertBefore(m,ct),x=Z(m),k({sortable:this,name:"onChange",params:this._getParams(t)}),this.animator.animate(),v=this.el},_onDrop:function(t){this._cancelStart(),M(X,"touchmove",this._nearestSortable),M(X,"mousemove",this._nearestSortable),M(X,"mouseup",this._onDrop),M(X,"touchend",this._onDrop),M(X,"touchcancel",this._onDrop),B&&(v=B,f=J,$===m&&($=p),this.animator.collect(N),this.multiplayer.toggleChosenClass(!1),P(p,this.options.chosenClass,!1),k({sortable:this,name:"onUnchoose",params:this._getParams(t)}),q&&this._onEnd(t),!q&&this.animator.animate()),!Bt(t.changedTouches?t.changedTouches[0]:t)&&this.multiplayer.onSelect(t,p,B,this),F&&F.parentNode&&F.parentNode.removeChild(F),this.autoScroller.stop(),this.multiplayer.nulling(),this._nulling()},_onEnd:function(t){P(m,this.options.chosenClass,!1),P(m,this.options.placeholderClass,!1);var n=a==="clone";this.multiplayer.onDrop(v,G,n);var e=this._getParams(t),s=this.options.swapOnDrop;n&&v!==G||!(typeof s=="function"?s(e):s)||N.insertBefore(p,m),n&&v!==G&&!this.multiplayer.active()||m&&m.parentNode&&m.parentNode.removeChild(m),w(p,"display",""),this.animator.animate(),v!==G&&k({sortable:v[Y],name:"onDrop",params:l({},e,n?W:{newIndex:-1})}),k({sortable:G[Y],name:"onDrop",params:l({},e,v===G?{}:{oldIndex:-1})})},_getParams:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e={};return e.event=t,e.to=G,e.from=v,e.node=p,e.clone=m,e.target=$,e.oldIndex=f,e.newIndex=x,e.pullMode=a,l(e,this.multiplayer.params(),n),e.relative=$===p?0:lt(m,$),e},_nulling:function(){G=v=B=p=b=ct=m=F=$=N=a=f=x=J=R=q=j=W=V=X=ht=St=C.clone=C.ghost=C.active=C.dragged=null},destroy:function(){this._cancelStart(),this._nulling(),this.multiplayer.nulling(),this.autoScroller.stop(),M(this.el,"touchstart",this._onDrag),M(this.el,"mousedown",this._onDrag);var t=ft.indexOf(this.el);t>-1&&ft.splice(t,1),this.el[Y]=this.animator=this.multiplayer=this.autoScroller=null},option:function(t,n){if(n===void 0)return this.options[t];this.options[t]=n,this.animator.options[t]=n,this.multiplayer.options[t]=n,this.autoScroller.options[t]=n,t==="group"&&bt(this.options)},select:function(t){this.multiplayer.select(t)},deselect:function(t){this.multiplayer.deselect(t)},getSelectedElements:function(){return this.multiplayer.selects}},C.utils={on:A,off:M,css:w,index:Z,closest:ut,getRect:K,toggleClass:P,detectDirection:rt},C.get=function(t){return t[Y]},C.create=function(t,n){return new C(t,n)},C})})(At);var Xt=At.exports;const et=Ht(Xt),Ot=["delay","group","handle","lockAxis","disabled","sortable","draggable","animation","autoScroll","ghostClass","ghostStyle","chosenClass","scrollSpeed","fallbackOnBody","scrollThreshold","delayOnTouchOnly","placeholderClass"];class qt{constructor(o,i){this.el=o,this.options=i,this.reRendered=!1,this.installSortable()}destroy(){this.sortable.destroy(),this.reRendered=!1}option(o,i){this.options[o]=i,Ot.includes(o)&&this.sortable.option(o,i)}installSortable(){const o=Ot.reduce((i,l)=>(i[l]=this.options[l],i),{});this.sortable=new et(this.el,{...o,emptyInsertThreshold:0,swapOnDrop:i=>i.from===i.to,onDrag:i=>this.onDrag(i),onDrop:i=>this.onDrop(i),onChoose:i=>this.onChoose(i),onUnchoose:i=>this.onUnchoose(i)})}onChoose(o){this.dispatchEvent("onChoose",o)}onUnchoose(o){this.dispatchEvent("onUnchoose",o)}onDrag(o){const i=o.node.getAttribute("data-key"),l=this.getIndex(i),d=this.options.list[l];this.sortable.option("store",{item:d,key:i,index:l}),this.dispatchEvent("onDrag",{item:d,key:i,index:l,event:o})}onDrop(o){var Q,L,O;const{item:i,key:l,index:d}=(Q=et.get(o.from))==null?void 0:Q.option("store"),y=this.options.list,T={key:l,item:i,list:y,event:o,changed:!1,oldList:[...y],oldIndex:d,newIndex:d};o.from===o.to&&o.node===o.target||this.handleDropEvent(o,T,d),this.dispatchEvent("onDrop",T),o.from===this.el&&this.reRendered&&((L=et.dragged)==null||L.remove()),o.from!==o.to&&o.pullMode==="clone"&&((O=et.clone)==null||O.remove()),this.reRendered=!1}handleDropEvent(o,i,l){const d=o.target.getAttribute("data-key");let y=-1,T=l;o.from===o.to?(T=this.getIndex(i.key),y=this.getIndex(d),(T<y&&o.relative===-1||T>y&&o.relative===1)&&(y+=o.relative),y!==T&&(i.list.splice(T,1),i.list.splice(y,0,i.item))):(o.from===this.el&&(T=this.getIndex(i.key),i.list.splice(T,1)),o.to===this.el&&(T=-1,y=this.getIndex(d),o.relative===0?y=i.list.length:o.relative===1&&(y+=o.relative),i.list.splice(y,0,i.item))),i.changed=o.from!==o.to||y!==T,i.oldIndex=T,i.newIndex=y}getIndex(o){return this.options.uniqueKeys.indexOf(o)}dispatchEvent(o,i){const l=this.options[o];l&&l(i)}}function Tt(u,o){let i;const l=function(...d){i||(o<=0?u.apply(this,d):i=setTimeout(()=>{i=null,u.apply(this,d)},o))};return l.cancel=function(){i&&(clearTimeout(i),i=null)},l}function Vt(u,o){const i=Tt(u,o),l=function(){i.cancel(),i.apply(this,arguments)};return l.cancel=function(){i.cancel()},l}function Nt(u,o){return(Array.isArray(o)?o:o.replace(/\[/g,".").replace(/\]/g,".").split(".")).reduce((i,l)=>(i||{})[l],u)}function kt(u){return u instanceof Document&&u.nodeType===9||u instanceof Window}const jt=["size","keeps","scroller","direction","debounceTime","throttleTime"];class Gt{constructor(o){this.options=o;const i={size:0,keeps:0,buffer:0,wrapper:null,scroller:null,direction:"vertical",uniqueKeys:[],debounceTime:null,throttleTime:null};for(const l in i)!(l in this.options)&&(this.options[l]=i[l]);this.sizes=new Map,this.sizeType="INIT",this.fixedSize=0,this.averageSize=0,this.range={start:0,end:0,front:0,behind:0},this.offset=0,this.direction="STATIONARY",this.updateScrollElement(),this.updateOnScrollFunction(),this.addScrollEventListener(),this.checkIfUpdate(0,o.keeps-1)}isFixed(){return this.sizeType==="FIXED"}isFront(){return this.direction==="FRONT"}isBehind(){return this.direction==="BEHIND"}isHorizontal(){return this.options.direction==="horizontal"}getSize(o){return this.sizes.get(o)||this.getItemSize()}getOffset(){const o=this.isHorizontal()?"scrollLeft":"scrollTop";return this.scrollEl[o]}getScrollSize(){const o=this.isHorizontal()?"scrollWidth":"scrollHeight";return this.scrollEl[o]}getClientSize(){const o=this.isHorizontal()?"offsetWidth":"offsetHeight";return this.scrollEl[o]}scrollToOffset(o){const i=this.isHorizontal()?"scrollLeft":"scrollTop";this.scrollEl[i]=o}scrollToIndex(o){if(o>=this.options.uniqueKeys.length-1)this.scrollToBottom();else{const i=this.getOffsetByIndex(o),l=this.getScrollStartOffset();this.scrollToOffset(i+l)}}scrollToBottom(){const o=this.getScrollSize();this.scrollToOffset(o),setTimeout(()=>{const i=this.getClientSize(),l=this.getScrollSize();this.getOffset()+i+1<l&&this.scrollToBottom()},5)}option(o,i){const l=this.options[o];this.options[o]=i,o==="uniqueKeys"&&this.sizes.forEach((d,y)=>{i.includes(y)||this.sizes.delete(y)}),o==="scroller"&&(l&&et.utils.off(l,"scroll",this.onScroll),this.updateScrollElement(),this.addScrollEventListener())}updateRange(o){if(o){this.handleUpdate(o.start);return}let i=this.range.start;i=Math.max(i,0),this.handleUpdate(i)}onItemResized(o,i){!i||this.sizes.get(o)===i||(this.sizes.set(o,i),this.sizeType==="INIT"?(this.sizeType="FIXED",this.fixedSize=i):this.isFixed()&&this.fixedSize!==i&&(this.sizeType="DYNAMIC",this.fixedSize=0),!this.averageSize&&this.sizeType==="DYNAMIC"&&this.sizes.size===this.options.keeps&&this.updateAverageSize())}updateAverageSize(){const o=[...this.sizes.values()].reduce((i,l)=>i+l,0);this.averageSize=Math.round(o/this.sizes.size)}addScrollEventListener(){this.options.scroller&&et.utils.on(this.options.scroller,"scroll",this.onScroll)}removeScrollEventListener(){this.options.scroller&&et.utils.off(this.options.scroller,"scroll",this.onScroll)}enableScroll(o){const{scroller:i}=this.options,l=o?et.utils.off:et.utils.on,d="onwheel"in document.createElement("div")?"wheel":"mousewheel";l(i,"DOMMouseScroll",this.preventDefault),l(i,d,this.preventDefault),l(i,"touchmove",this.preventDefault),l(i,"keydown",this.preventDefaultForKeyDown)}preventDefault(o){o.preventDefault()}preventDefaultForKeyDown(o){if({37:1,38:1,39:1,40:1}[o.keyCode])return this.preventDefault(o),!1}updateScrollElement(){const o=this.options.scroller;kt(o)?this.scrollEl=document.scrollingElement||document.documentElement||document.body:this.scrollEl=o}updateOnScrollFunction(){const{debounceTime:o,throttleTime:i}=this.options;o?this.onScroll=Vt(()=>this.handleScroll(),o):i?this.onScroll=Tt(()=>this.handleScroll(),i):this.onScroll=()=>this.handleScroll()}handleScroll(){const o=this.getOffset(),i=this.getClientSize(),l=this.getScrollSize();o===this.offset?this.direction="STATIONARY":this.direction=o<this.offset?"FRONT":"BEHIND",this.offset=o;const d=this.isFront()&&o<=0,y=this.isBehind()&&i+o>=l;this.options.onScroll({top:d,bottom:y,offset:o,direction:this.direction}),this.isFront()?this.handleScrollFront():this.isBehind()&&this.handleScrollBehind()}handleScrollFront(){const o=this.getScrollItems();if(o>=this.range.start)return;const i=Math.max(o-this.options.buffer,0);this.checkIfUpdate(i,this.getEndByStart(i))}handleScrollBehind(){const o=this.getScrollItems();o<this.range.start+this.options.buffer||this.checkIfUpdate(o,this.getEndByStart(o))}getScrollItems(){const o=this.offset-this.getScrollStartOffset();if(o<=0)return 0;if(this.isFixed())return Math.floor(o/this.fixedSize);let i=0,l=this.options.uniqueKeys.length,d=0,y=0;for(;i<=l;){if(d=i+Math.floor((l-i)/2),y=this.getOffsetByIndex(d),y===o)return d;y<o?i=d+1:y>o&&(l=d-1)}return i>0?--i:0}checkIfUpdate(o,i){const l=this.options.keeps;this.options.uniqueKeys.length<=l?o=0:i-o<l-1&&(o=i-l+1),this.range.start!==o&&this.handleUpdate(o)}handleUpdate(o){this.range.start=o,this.range.end=this.getEndByStart(o),this.range.front=this.getFrontOffset(),this.range.behind=this.getBehindOffset(),this.options.onUpdate({...this.range})}getFrontOffset(){return this.isFixed()?this.fixedSize*this.range.start:this.getOffsetByIndex(this.range.start)}getBehindOffset(){const o=this.range.end,i=this.getLastIndex();return this.isFixed()?(i-o)*this.fixedSize:(i-o)*this.getItemSize()}getOffsetByIndex(o){if(!o)return 0;let i=0;for(let l=0;l<o;l++){const d=this.sizes.get(this.options.uniqueKeys[l]);i=i+(typeof d=="number"?d:this.getItemSize())}return i}getEndByStart(o){return Math.min(o+this.options.keeps-1,this.getLastIndex())}getLastIndex(){const{uniqueKeys:o,keeps:i}=this.options;return o.length>0?o.length-1:i-1}getItemSize(){return this.isFixed()?this.fixedSize:this.options.size||this.averageSize}getScrollStartOffset(){const{wrapper:o,scroller:i}=this.options;if(i===o)return 0;let l=0;if(i&&o){const d=this.isHorizontal()?"left":"top",y=kt(i)?et.utils.getRect(o):et.utils.getRect(o,!0,i);l=this.offset+y[d]}return l}}const $t={dataSource:{},modelValue:{},dataKey:{type:String,default:"",required:!0},tableMode:{type:Boolean,default:!1},draggable:{type:String,default:".virtual-dnd-list-item"},itemClass:{type:String,default:"virtual-dnd-list-item"},sortable:{type:Boolean,default:!0},handle:{type:[Function,String]},group:{type:[Object,String]},scroller:{type:[Document,HTMLElement]},lockAxis:{type:String,default:""},direction:{type:String,default:"vertical"},keeps:{type:Number,default:30},size:{type:Number},debounceTime:{type:Number,default:0},throttleTime:{type:Number,default:0},animation:{type:Number,default:150},autoScroll:{type:Boolean,default:!0},scrollSpeed:{type:Object,default:()=>({x:10,y:10})},scrollThreshold:{type:Number,default:55},keepOffset:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},fallbackOnBody:{type:Boolean,default:!1},delay:{type:Number,default:0},delayOnTouchOnly:{type:Boolean,default:!1},rootTag:{type:String,default:"div"},wrapTag:{type:String,default:"div"},wrapClass:{type:String,default:""},wrapStyle:{type:Object,default:()=>({})},ghostClass:{type:String,default:""},ghostStyle:{type:Object,default:()=>({})},chosenClass:{type:String,default:""},placeholderClass:{type:String,default:""}},Jt={dataKey:{type:[String,Number]},sizeKey:{type:String,default:"offsetHeight"},itemClass:{type:String}},Qt=({mounted:u,updated:o,unmounted:i})=>Mt({props:["vnode"],mounted(){u(this.$el)},onUpdated(){o(this.$el)},onUnmounted(){i(this.$el)},render(l){return l.vnode}}),Zt=Mt({props:Jt,emits:["resize"],setup(u,{emit:o,slots:i}){let l=null;const d=O=>{const it=O?O[u.sizeKey]:0;o("resize",it,u.dataKey)},L=Qt({mounted:O=>{typeof ResizeObserver<"u"&&(l=new ResizeObserver(()=>{d(O)}),O&&l.observe(O))},updated:O=>{d(O)},unmounted:()=>{l&&(l.disconnect(),l=null)}});return()=>{var M;const{dataKey:O,itemClass:it}=u,[A]=((M=i.default)==null?void 0:M.call(i))||[];return yt(L,{key:O,class:it,vnode:A,"data-key":O},{default:()=>{var st;return(st=i.default)==null?void 0:st.call(i)}})}}}),te=u=>Wt(u)?u.value:u,oe=Mt({props:$t,emits:["update:dataSource","update:modelValue","top","bottom","drag","drop","rangeChange"],setup(u,{emit:o,slots:i,expose:l}){const d=gt({start:0,end:u.keeps-1,front:0,behind:0}),y=_t(()=>u.direction!=="vertical"),T=gt(null),Q=gt(null),L=gt([]);function O(a){return S.getSize(a)}function it(){return S.getOffset()}function A(){return S.getClientSize()}function M(){return S.getScrollSize()}function st(a){const f=nt.indexOf(a);f>-1&&S.scrollToIndex(f)}function K(a){S.scrollToOffset(a)}function ut(a){S.scrollToIndex(a)}function mt(){K(0)}function wt(){S.scrollToBottom()}l({getSize:O,getOffset:it,getClientSize:A,getScrollSize:M,scrollToTop:mt,scrollToBottom:wt,scrollToKey:st,scrollToIndex:ut,scrollToOffset:K}),Et(()=>[u.dataSource,u.modelValue],()=>{P()},{deep:!0}),Lt(()=>{P()}),Kt(()=>{S&&K(S.offset),S.addScrollEventListener()}),Pt(()=>{S.removeScrollEventListener()}),Ut(()=>{It(),F()}),Yt(()=>{v==null||v.destroy(),S==null||S.removeScrollEventListener()});let Z=[],nt=[],rt=0;const P=()=>{const a=te(u.modelValue||u.dataSource);if(a){if(L.value=a,dt(),w(Z,a),v==null||v.option("list",a),rt&&u.keepOffset){const f=a.length-rt;f>0&&ut(f),rt=0}Z=[...L.value]}},dt=()=>{nt=L.value.map(a=>Nt(a,u.dataKey)),S==null||S.option("uniqueKeys",nt),v==null||v.option("uniqueKeys",nt)},w=(a,f)=>{if(!a.length&&!f.length||a.length===f.length)return;let x={...d.value};f.length>a.length&&x.end===a.length-1&&lt()&&x.start++,S==null||S.updateRange(x)},lt=()=>{const a=it(),f=A(),x=M();return a+f+1>=x};let S;const k=gt(),D=gt(!1),at=_t(()=>jt.reduce((a,f)=>(a[f]=u[f],a),{}));Et(at,(a,f)=>{if(S)for(let x in a)a[x]!==f[x]&&S.option(x,a[x])});const vt=Tt(()=>{rt=L.value.length,o("top")},50),Y=Tt(()=>{o("bottom")},50),xt=a=>{rt=0,L.value.length&&a.top?vt():a.bottom&&Y()},zt=a=>{const f=a.start!==d.value.start;D.value&&f&&v&&(v.reRendered=!0),d.value=a,f&&o("rangeChange",a)},It=()=>{S=new Gt({...at.value,buffer:Math.round(u.keeps/3),wrapper:Q.value,scroller:u.scroller||T.value,uniqueKeys:nt,onScroll:xt,onUpdate:zt})},G=(a,f)=>{if(f===k.value)return;const x=S.sizes.size,J=Math.min(u.keeps,L.value.length);S.onItemResized(f,a),x===J-1&&S.updateRange(d.value)};let v;const B=_t(()=>Ot.reduce((a,f)=>(a[f]=u[f],a),{}));Et(B,(a,f)=>{if(v)for(let x in a)a[x]!==f[x]&&v.option(x,a[x])});const p=a=>{k.value=a.node.getAttribute("data-key")},b=()=>{k.value=""},ct=a=>{D.value=!0,u.sortable||(S.enableScroll(!1),v.option("autoScroll",!1)),o("drag",a)},m=a=>{D.value=!1,S.enableScroll(!0),v.option("autoScroll",u.autoScroll),a.changed&&(o("update:dataSource",a.list),o("update:modelValue",a.list)),o("drop",a)},F=()=>{v=new qt(T.value,{...B.value,list:L.value,uniqueKeys:nt,onDrag:ct,onDrop:m,onChoose:p,onUnchoose:b})},$=a=>{if(u.tableMode){const f={padding:0,border:0,height:`${a}px`};return yt("tr",{},[yt("td",{style:f})])}return null},N=()=>{const a=[],{start:f,end:x,front:J,behind:R}=d.value,q=y.value?"offsetWidth":"offsetHeight";a.push($(J));for(let j=f;j<=x;j++){const W=L.value[j];if(W){const V=Nt(W,u.dataKey);a.push(i.item?yt(Zt,{key:V,class:u.itemClass,style:D.value&&V==k.value&&{display:"none"},dataKey:V,sizeKey:q,onResize:G},{default:()=>{var X;return(X=i.item)==null?void 0:X.call(i,{record:W,index:j,dataKey:V})}}):null)}}return a.push($(R)),a};return()=>{const{front:a,behind:f}=d.value,{tableMode:x,rootTag:J,wrapTag:R,scroller:q,wrapClass:j,wrapStyle:W}=u,V=y.value?"auto hidden":"hidden auto",X=y.value?`0 ${f}px 0 ${a}px`:`${a}px 0 ${f}px`,ht=x?"table":J,St=x?"tbody":R;return yt(ht,{ref:T,style:!q&&!x&&{overflow:V}},{default:()=>{var ft,bt;return[(ft=i.header)==null?void 0:ft.call(i),yt(St,{ref:Q,class:j,style:{...W,padding:!x&&X}},{default:()=>N()}),(bt=i.footer)==null?void 0:bt.call(i)]}})}}});export{oe as default};
